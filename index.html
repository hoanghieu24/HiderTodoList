<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="HiderBuilding.png">
    <title>HiderBuilding.io - Quản lý công việc dự án</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a3a5f;
            --secondary-color: #2c5282;
            --accent-color: #3182ce;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #212529;
            --white: #ffffff;
            --pending: #f59e0b;
            --doing: #3b82f6;
            --blocked: #ef4444;
            --done: #10b981;
            --property: #8b5cf6;
            --note: #ec4899;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            --radius: 8px;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f7fa;
            color: var(--dark-gray);
            line-height: 1.5;
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }

        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo-img {
            width: 34px;
            height: 34px;
            object-fit: contain;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .clock {
            font-size: 1.2rem;
            font-weight: 500;
            color: white;
            margin-right: 15px;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #dfe1e6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }

        .dashboard {
            display: flex;
            min-height: calc(100vh - 60px);
        }

        .sidebar {
            width: 250px;
            background-color: var(--white);
            box-shadow: var(--shadow);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-menu {
            list-style: none;
            margin-top: 20px;
        }

        .sidebar-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }

        .sidebar-item:hover {
            background-color: var(--light-gray);
        }

        .sidebar-item.active {
            background-color: rgba(26, 58, 95, 0.1);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .project-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .project-select {
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--radius);
            background-color: var(--white);
            min-width: 200px;
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-column {
            background-color: var(--white);
            border-radius: var(--radius);
            padding: 15px;
            box-shadow: var(--shadow);
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid;
        }

        .status-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-count {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
        }

        .status-pending .status-header {
            color: var(--pending);
            border-color: var(--pending);
        }

        .status-doing .status-header {
            color: var(--doing);
            border-color: var(--doing);
        }

        .status-blocked .status-header {
            color: var(--blocked);
            border-color: var(--blocked);
        }

        .status-done .status-header {
            color: var(--done);
            border-color: var(--done);
        }

        .task-list {
            min-height: 100px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .task {
            background-color: var(--white);
            border-radius: var(--radius);
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 4px solid;
        }

        .task-pending {
            border-left-color: var(--pending);
        }

        .task-doing {
            border-left-color: var(--doing);
        }

        .task-blocked {
            border-left-color: var(--blocked);
        }

        .task-done {
            border-left-color: var(--done);
        }

        .task:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .task-title {
            font-weight: 500;
            margin-bottom: 5px;
            word-break: break-word;
        }

        .task-desc {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6b7280;
        }

        .task-date {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-action {
            color: #6b7280;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .task-action:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .add-task-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #6b7280;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
            border: none;
            background: none;
            margin-top: 10px;
        }

        .add-task-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .add-task-form {
            margin-top: 10px;
            display: none;
        }

        .add-task-form.active {
            display: block;
        }

        .add-task-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--radius);
            margin-bottom: 8px;
            font-family: inherit;
            resize: none;
        }

        .add-task-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .add-task-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .add-task-submit {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 8px 12px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .add-task-submit:hover {
            background-color: var(--secondary-color);
        }

        .cancel-add-task {
            font-size: 20px;
            color: #6b7280;
            cursor: pointer;
        }

        .btn {
            padding: 8px 16px;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--dark-gray);
        }

        .btn-secondary:hover {
            background-color: #e2e4e9;
        }

        .btn-danger {
            background-color: var(--blocked);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: var(--radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .modal-close {
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-input,
        .form-textarea,
        .form-select,
        .form-date {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--radius);
            font-family: inherit;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus,
        .form-date:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(49, 130, 206, 0.2);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid var(--medium-gray);
        }

        .image-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed var(--medium-gray);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .image-upload:hover {
            border-color: var(--accent-color);
        }

        .image-upload i {
            font-size: 24px;
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        .uploaded-images {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .image-preview {
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
            height: 100px;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(239, 68, 68, 0.8);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }

        .notes-container {
            margin-top: 20px;
        }

        .note-item {
            background-color: var(--light-gray);
            border-radius: var(--radius);
            padding: 12px;
            margin-bottom: 10px;
            position: relative;
        }

        .note-date {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 5px;
        }

        .note-content {
            margin-bottom: 5px;
        }

        .note-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 5px;
        }

        .note-action {
            color: var(--accent-color);
            cursor: pointer;
            font-size: 12px;
        }

        .note-action.delete {
            color: var(--blocked);
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }

        .empty-state i {
            font-size: 40px;
            margin-bottom: 10px;
            color: #d1d5db;
        }

        .priority-badge {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
        }

        .priority-high {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--blocked);
        }

        .priority-medium {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--pending);
        }

        .priority-low {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--done);
        }

        .task-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 8px;
        }

        .task-tag {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            background-color: #e5e7eb;
            color: #4b5563;
        }

        /* Toast notification */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 15px 20px;
            border-radius: var(--radius);
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
            animation: toastIn 0.3s ease-out, toastOut 0.3s ease-in 2.7s forwards;
            max-width: 350px;
        }

        .toast-success {
            background-color: var(--success);
        }

        .toast-error {
            background-color: var(--error);
        }

        .toast-warning {
            background-color: var(--warning);
        }

        .toast-info {
            background-color: var(--info);
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes toastOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        /* Project dashboard */
        .project-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background-color: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .dashboard-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .dashboard-card-title {
            font-weight: 600;
            color: var(--primary-color);
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #6b7280;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--medium-gray);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            background-color: var(--accent-color);
        }

        .project-list {
            list-style: none;
        }

        .project-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .project-item:last-child {
            border-bottom: none;
        }

        .project-item-info {
            flex: 1;
        }

        .project-item-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .project-item-desc {
            font-size: 13px;
            color: #6b7280;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .project-item-actions {
            display: flex;
            gap: 8px;
        }

        /* Images page */
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .image-card {
            background-color: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .image-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .image-card-body {
            padding: 10px;
        }

        .image-card-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            word-break: break-word;
        }

        .image-card-date {
            font-size: 12px;
            color: #6b7280;
        }

        /* Notes page */
        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .note-card {
            background-color: var(--white);
            border-radius: var(--radius);
            padding: 15px;
            box-shadow: var(--shadow);
            height: 200px;
            display: flex;
            flex-direction: column;
        }

        .note-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .note-card-title {
            font-weight: 500;
            margin-right: 10px;
            word-break: break-word;
        }

        .note-card-date {
            font-size: 12px;
            color: #6b7280;
            white-space: nowrap;
        }

        .note-card-content {
            flex: 1;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 6;
            -webkit-box-orient: vertical;
            font-size: 14px;
            color: #4b5563;
        }

        .note-card-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        /* Reports page */
        .reports-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .report-card {
            background-color: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        /* Settings page */
        .settings-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }

        .settings-menu {
            background-color: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .settings-menu-item {
            padding: 10px 0;
            cursor: pointer;
            border-bottom: 1px solid var(--medium-gray);
        }

        .settings-menu-item:last-child {
            border-bottom: none;
        }

        .settings-menu-item.active {
            color: var(--primary-color);
            font-weight: 500;
        }

        .settings-content {
            background-color: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
            padding-bottom: 10px;
            border-bottom: 1px solid var(--medium-gray);
        }

        @media (max-width: 992px) {
            .dashboard {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 10px;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
                margin-top: 10px;
            }
            
            .sidebar-item {
                border-left: none;
                border-bottom: 3px solid transparent;
                white-space: nowrap;
            }
            
            .sidebar-item.active {
                border-left: none;
                border-bottom-color: var(--primary-color);
            }

            .settings-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .kanban-board {
                grid-template-columns: 1fr;
            }
            
            .project-selector {
                flex-direction: column;
                align-items: flex-start;
            }

            .project-dashboard {
                grid-template-columns: 1fr;
            }

            .images-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .notes-grid {
                grid-template-columns: 1fr;
            }

            .reports-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="logo">
            <img src="HiderBuilding-Photoroom.png" alt="logo" class="logo-img">
            <span>HiderBuilding.io</span>
        </div>
        <div class="user-menu">
            <div id="clock" class="clock">00:00:00</div>
            <div class="avatar">H</div>
        </div>
    </header>

    <div class="dashboard">
        <aside class="sidebar">
            <div class="sidebar-menu">
                <div class="sidebar-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Tổng quan</span>
                </div>
                <div class="sidebar-item" data-page="projects">
                    <i class="fas fa-building"></i>
                    <span>Dự án</span>
                </div>
                <div class="sidebar-item" data-page="tasks">
                    <i class="fas fa-tasks"></i>
                    <span>Quản lý công việc</span>
                </div>
                <div class="sidebar-item" data-page="images">
                    <i class="fas fa-images"></i>
                    <span>Hình ảnh</span>
                </div>
                <div class="sidebar-item" data-page="notes">
                    <i class="fas fa-sticky-note"></i>
                    <span>Ghi chú</span>
                </div>
                <div class="sidebar-item" data-page="reports">
                    <i class="fas fa-chart-line"></i>
                    <span>Báo cáo</span>
                </div>
                <div class="sidebar-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Cài đặt</span>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <!-- Dashboard Page -->
            <div class="page-content" id="dashboard-page">
                <div class="page-header">
                    <h1 class="page-title">Tổng quan dự án</h1>
                    <button class="btn btn-primary" onclick="showAddProjectModal()">
                        <i class="fas fa-plus"></i> Thêm dự án
                    </button>
                </div>

                <div class="project-dashboard">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h3 class="dashboard-card-title">Tổng số dự án</h3>
                            <i class="fas fa-building" style="color: var(--primary-color);"></i>
                        </div>
                        <div class="stat-number" id="total-projects">0</div>
                        <div class="stat-label">Dự án đang hoạt động</div>
                    </div>

                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h3 class="dashboard-card-title">Công việc</h3>
                            <i class="fas fa-tasks" style="color: var(--primary-color);"></i>
                        </div>
                        <div class="stat-number" id="total-tasks">0</div>
                        <div class="stat-label">Tổng số công việc</div>
                    </div>

                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h3 class="dashboard-card-title">Tiến độ tổng thể</h3>
                            <i class="fas fa-chart-pie" style="color: var(--primary-color);"></i>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="overall-progress" style="width: 0%"></div>
                        </div>
                        <div class="stat-label" id="progress-text">0% công việc đã hoàn thành</div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="dashboard-card-header">
                        <h3 class="dashboard-card-title">Dự án gần đây</h3>
                        <button class="btn btn-secondary" onclick="navigateTo('projects')">
                            <i class="fas fa-eye"></i> Xem tất cả
                        </button>
                    </div>
                    <ul class="project-list" id="recent-projects">
                        <li class="project-item">
                            <div class="project-item-info">
                                <div class="project-item-name">Không có dự án nào</div>
                                <div class="project-item-desc">Hãy thêm dự án đầu tiên của bạn</div>
                            </div>
                            <div class="project-item-actions">
                                <button class="btn btn-secondary" disabled>
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Projects Page -->
            <div class="page-content" id="projects-page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Quản lý dự án</h1>
                    <button class="btn btn-primary" onclick="showAddProjectModal()">
                        <i class="fas fa-plus"></i> Thêm dự án
                    </button>
                </div>

                <div class="project-list" id="all-projects">
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>Chưa có dự án nào</p>
                        <button class="btn btn-primary" onclick="showAddProjectModal()">
                            <i class="fas fa-plus"></i> Thêm dự án đầu tiên
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tasks Page -->
            <div class="page-content" id="tasks-page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Quản lý công việc</h1>
                    <button class="btn btn-primary" onclick="showAddProjectModal()">
                        <i class="fas fa-plus"></i> Thêm dự án
                    </button>
                </div>

                <div class="project-selector">
                    <label for="project-select">Chọn dự án:</label>
                    <select class="project-select" id="project-select" onchange="changeProject(this.value)">
                        <option value="">-- Chọn dự án --</option>
                    </select>
                    <button class="btn btn-primary" onclick="showAddTaskModal()">
                        <i class="fas fa-plus"></i> Thêm công việc
                    </button>
                </div>

                <div class="kanban-board">
                    <div class="status-column status-pending">
                        <div class="status-header">
                            <div class="status-title">
                                <i class="fas fa-clock"></i>
                                <span>Đang chờ</span>
                            </div>
                            <span class="status-count" id="pending-count">0</span>
                        </div>
                        <div class="task-list" data-status="pending" id="pending-tasks">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>Không có công việc nào</p>
                            </div>
                        </div>
                        <button class="add-task-btn" onclick="showAddTaskForm('pending')">
                            <i class="fas fa-plus"></i> Thêm công việc
                        </button>
                        <div class="add-task-form" id="add-task-form-pending">
                            <textarea class="add-task-input" placeholder="Nhập tiêu đề công việc..."></textarea>
                            <div class="add-task-controls">
                                <button class="add-task-submit" onclick="addTaskFromForm('pending')">Thêm</button>
                                <i class="fas fa-times cancel-add-task" onclick="hideAddTaskForm('pending')"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="status-column status-doing">
                        <div class="status-header">
                            <div class="status-title">
                                <i class="fas fa-hard-hat"></i>
                                <span>Đang làm</span>
                            </div>
                            <span class="status-count" id="doing-count">0</span>
                        </div>
                        <div class="task-list" data-status="doing" id="doing-tasks">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>Không có công việc nào</p>
                            </div>
                        </div>
                        <button class="add-task-btn" onclick="showAddTaskForm('doing')">
                            <i class="fas fa-plus"></i> Thêm công việc
                        </button>
                        <div class="add-task-form" id="add-task-form-doing">
                            <textarea class="add-task-input" placeholder="Nhập tiêu đề công việc..."></textarea>
                            <div class="add-task-controls">
                                <button class="add-task-submit" onclick="addTaskFromForm('doing')">Thêm</button>
                                <i class="fas fa-times cancel-add-task" onclick="hideAddTaskForm('doing')"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="status-column status-blocked">
                        <div class="status-header">
                            <div class="status-title">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Bị mắc</span>
                            </div>
                            <span class="status-count" id="blocked-count">0</span>
                        </div>
                        <div class="task-list" data-status="blocked" id="blocked-tasks">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>Không có công việc nào</p>
                            </div>
                        </div>
                        <button class="add-task-btn" onclick="showAddTaskForm('blocked')">
                            <i class="fas fa-plus"></i> Thêm công việc
                        </button>
                        <div class="add-task-form" id="add-task-form-blocked">
                            <textarea class="add-task-input" placeholder="Nhập tiêu đề công việc..."></textarea>
                            <div class="add-task-controls">
                                <button class="add-task-submit" onclick="addTaskFromForm('blocked')">Thêm</button>
                                <i class="fas fa-times cancel-add-task" onclick="hideAddTaskForm('blocked')"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="status-column status-done">
                        <div class="status-header">
                            <div class="status-title">
                                <i class="fas fa-check-circle"></i>
                                <span>Đã hoàn thành</span>
                            </div>
                            <span class="status-count" id="done-count">0</span>
                        </div>
                        <div class="task-list" data-status="done" id="done-tasks">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>Không có công việc nào</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Images Page -->
            <div class="page-content" id="images-page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Hình ảnh dự án</h1>
                    <button class="btn btn-primary" onclick="showUploadImageModal()">
                        <i class="fas fa-upload"></i> Tải lên hình ảnh
                    </button>
                </div>

                <div class="project-selector">
                    <label for="image-project-select">Chọn dự án:</label>
                    <select class="project-select" id="image-project-select" onchange="loadProjectImages(this.value)">
                        <option value="">-- Chọn dự án --</option>
                    </select>
                </div>

                <div class="images-grid" id="project-images-container">
                    <div class="empty-state">
                        <i class="fas fa-images"></i>
                        <p>Chưa có hình ảnh nào</p>
                        <p>Hãy chọn một dự án để xem hình ảnh</p>
                    </div>
                </div>
            </div>

            <!-- Notes Page -->
            <div class="page-content" id="notes-page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Ghi chú dự án</h1>
                    <button class="btn btn-primary" onclick="showAddNoteModal()">
                        <i class="fas fa-plus"></i> Thêm ghi chú
                    </button>
                </div>

                <div class="project-selector">
                    <label for="note-project-select">Chọn dự án:</label>
                    <select class="project-select" id="note-project-select" onchange="loadProjectNotes(this.value)">
                        <option value="">-- Chọn dự án --</option>
                    </select>
                </div>

                <div class="notes-grid" id="project-notes-container">
                    <div class="empty-state">
                        <i class="fas fa-sticky-note"></i>
                        <p>Chưa có ghi chú nào</p>
                        <p>Hãy chọn một dự án để xem ghi chú</p>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div class="page-content" id="reports-page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Báo cáo và phân tích</h1>
                    <button class="btn btn-primary" onclick="generateReport()">
                        <i class="fas fa-download"></i> Xuất báo cáo
                    </button>
                </div>

                <div class="project-selector">
                    <label for="report-project-select">Chọn dự án:</label>
                    <select class="project-select" id="report-project-select" onchange="loadProjectReport(this.value)">
                        <option value="">-- Tất cả dự án --</option>
                    </select>
                </div>

                <div class="reports-container" id="reports-container">
                    <div class="report-card">
                        <h3 class="dashboard-card-title">Phân tích trạng thái công việc</h3>
                        <div class="chart-container" id="task-status-chart">
                            <div class="empty-state">
                                <i class="fas fa-chart-pie"></i>
                                <p>Chọn dự án để xem báo cáo</p>
                            </div>
                        </div>
                    </div>

                    <div class="report-card">
                        <h3 class="dashboard-card-title">Tiến độ theo thời gian</h3>
                        <div class="chart-container" id="progress-timeline-chart">
                            <div class="empty-state">
                                <i class="fas fa-chart-line"></i>
                                <p>Chọn dự án để xem báo cáo</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page-content" id="settings-page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Cài đặt hệ thống</h1>
                </div>

                <div class="settings-container">
                    <div class="settings-menu">
                        <div class="settings-menu-item active" data-settings="general">Cài đặt chung</div>
                        <div class="settings-menu-item" data-settings="notifications">Thông báo</div>
                        <div class="settings-menu-item" data-settings="appearance">Giao diện</div>
                        <div class="settings-menu-item" data-settings="account">Tài khoản</div>
                        <div class="settings-menu-item" data-settings="backup">Sao lưu & Khôi phục</div>
                    </div>

                    <div class="settings-content">
                        <div class="settings-section" id="general-settings">
                            <h3 class="settings-section-title">Cài đặt chung</h3>
                            <div class="form-group">
                                <label class="form-label">Ngôn ngữ</label>
                                <select class="form-select" id="language-select">
                                    <option value="vi">Tiếng Việt</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Múi giờ</label>
                                <select class="form-select" id="timezone-select">
                                    <option value="+7">GMT+7 (Việt Nam)</option>
                                    <option value="+0">GMT+0 (UTC)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Định dạng ngày tháng</label>
                                <select class="form-select" id="date-format-select">
                                    <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                                    <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                    <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                </select>
                            </div>
                            <button class="btn btn-primary">Lưu cài đặt</button>
                        </div>

                        <div class="settings-section" id="notifications-settings" style="display: none;">
                            <h3 class="settings-section-title">Cài đặt thông báo</h3>
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="email-notifications" checked> Thông báo qua email
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="task-notifications" checked> Thông báo công việc mới
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="deadline-notifications" checked> Thông báo sắp đến hạn
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tần suất thông báo</label>
                                <select class="form-select" id="notification-frequency">
                                    <option value="instant">Ngay lập tức</option>
                                    <option value="daily">Hàng ngày</option>
                                    <option value="weekly">Hàng tuần</option>
                                </select>
                            </div>
                            <button class="btn btn-primary">Lưu cài đặt</button>
                        </div>

                        <div class="settings-section" id="appearance-settings" style="display: none;">
                            <h3 class="settings-section-title">Cài đặt giao diện</h3>
                            <div class="form-group">
                                <label class="form-label">Chủ đề</label>
                                <select class="form-select" id="theme-select">
                                    <option value="light">Sáng</option>
                                    <option value="dark">Tối</option>
                                    <option value="auto">Tự động</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Mật độ hiển thị</label>
                                <select class="form-select" id="density-select">
                                    <option value="comfortable">Thoải mái</option>
                                    <option value="compact">Nhỏ gọn</option>
                                </select>
                            </div>
                            <button class="btn btn-primary">Lưu cài đặt</button>
                        </div>

                        <div class="settings-section" id="account-settings" style="display: none;">
                            <h3 class="settings-section-title">Cài đặt tài khoản</h3>
                            <div class="form-group">
                                <label class="form-label">Tên hiển thị</label>
                                <input type="text" class="form-input" id="display-name" value="Hider User">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" id="email" value="user@hiderbuilding.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Mật khẩu hiện tại</label>
                                <input type="password" class="form-input" id="current-password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Mật khẩu mới</label>
                                <input type="password" class="form-input" id="new-password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Xác nhận mật khẩu mới</label>
                                <input type="password" class="form-input" id="confirm-password">
                            </div>
                            <button class="btn btn-primary">Cập nhật thông tin</button>
                        </div>

                        <div class="settings-section" id="backup-settings" style="display: none;">
                            <h3 class="settings-section-title">Sao lưu & Khôi phục</h3>
                            <div class="form-group">
                                <label class="form-label">Sao lưu dữ liệu</label>
                                <p class="form-text">Tải xuống bản sao lưu toàn bộ dữ liệu của bạn</p>
                                <button class="btn btn-primary" onclick="backupData()">
                                    <i class="fas fa-download"></i> Sao lưu dữ liệu
                                </button>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Khôi phục dữ liệu</label>
                                <p class="form-text">Tải lên file sao lưu để khôi phục dữ liệu</p>
                                <input type="file" class="form-input" id="restore-file" accept=".json">
                                <button class="btn btn-primary" onclick="restoreData()" style="margin-top: 10px;">
                                    <i class="fas fa-upload"></i> Khôi phục dữ liệu
                                </button>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Xóa dữ liệu</label>
                                <p class="form-text">Xóa toàn bộ dữ liệu ứng dụng. Hành động này không thể hoàn tác.</p>
                                <button class="btn btn-danger" onclick="confirmResetData()">
                                    <i class="fas fa-trash"></i> Xóa toàn bộ dữ liệu
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Add Project Modal -->
    <div class="modal" id="add-project-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Thêm dự án mới</h3>
                <span class="modal-close" onclick="hideModal('add-project-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Tên dự án</label>
                    <input type="text" class="form-input" id="project-name" placeholder="Nhập tên dự án">
                </div>
                <div class="form-group">
                    <label class="form-label">Mô tả dự án</label>
                    <textarea class="form-textarea" id="project-desc" placeholder="Nhập mô tả dự án"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Địa chỉ</label>
                    <textarea class="form-textarea" id="project-address" placeholder="Nhập địa chỉ dự án"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Hình ảnh dự án</label>
                    <div class="image-upload" onclick="document.getElementById('project-images').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Nhấp để tải lên hoặc kéo thả hình ảnh</p>
                        <input type="file" id="project-images" multiple style="display: none;" onchange="handleImageUpload(event, 'project')">
                    </div>
                    <div class="uploaded-images" id="project-uploaded-images">
                        <!-- Uploaded images will appear here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('add-project-modal')">Hủy</button>
                <button class="btn btn-primary" onclick="addNewProject()">Thêm dự án</button>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div class="modal" id="add-task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Thêm công việc mới</h3>
                <span class="modal-close" onclick="hideModal('add-task-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Tiêu đề công việc</label>
                    <input type="text" class="form-input" id="task-title" placeholder="Nhập tiêu đề công việc">
                </div>
                <div class="form-group">
                    <label class="form-label">Mô tả chi tiết</label>
                    <textarea class="form-textarea" id="task-desc" placeholder="Nhập mô tả chi tiết"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Trạng thái</label>
                    <select class="form-select" id="task-status">
                        <option value="pending">Đang chờ</option>
                        <option value="doing">Đang làm</option>
                        <option value="blocked">Bị mắc</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ưu tiên</label>
                    <select class="form-select" id="task-priority">
                        <option value="low">Thấp</option>
                        <option value="medium" selected>Trung bình</option>
                        <option value="high">Cao</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Hạn hoàn thành</label>
                    <input type="date" class="form-date" id="task-deadline">
                </div>
                <div class="form-group">
                    <label class="form-label">Tags</label>
                    <input type="text" class="form-input" id="task-tags" placeholder="Nhập tags, phân cách bằng dấu phẩy">
                </div>
                <div class="form-group">
                    <label class="form-label">Hình ảnh đính kèm</label>
                    <div class="image-upload" onclick="document.getElementById('task-images').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Nhấp để tải lên hoặc kéo thả hình ảnh</p>
                        <input type="file" id="task-images" multiple style="display: none;" onchange="handleImageUpload(event, 'task')">
                    </div>
                    <div class="uploaded-images" id="task-uploaded-images">
                        <!-- Uploaded images will appear here -->
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ghi chú</label>
                    <textarea class="form-textarea" id="task-notes" placeholder="Thêm ghi chú cho công việc"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('add-task-modal')">Hủy</button>
                <button class="btn btn-primary" onclick="addNewTask()">Thêm công việc</button>
            </div>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div class="modal" id="task-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Chi tiết công việc</h3>
                <span class="modal-close" onclick="hideModal('task-detail-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Content will be loaded dynamically -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="deleteCurrentTask()">Xóa</button>
                <button class="btn btn-secondary" onclick="hideModal('task-detail-modal')">Đóng</button>
                <button class="btn btn-primary" id="edit-task-btn">Chỉnh sửa</button>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div class="modal" id="edit-task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Chỉnh sửa công việc</h3>
                <span class="modal-close" onclick="hideModal('edit-task-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Tiêu đề công việc</label>
                    <input type="text" class="form-input" id="edit-task-title" placeholder="Nhập tiêu đề công việc">
                </div>
                <div class="form-group">
                    <label class="form-label">Mô tả chi tiết</label>
                    <textarea class="form-textarea" id="edit-task-desc" placeholder="Nhập mô tả chi tiết"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Trạng thái</label>
                    <select class="form-select" id="edit-task-status">
                        <option value="pending">Đang chờ</option>
                        <option value="doing">Đang làm</option>
                        <option value="blocked">Bị mắc</option>
                        <option value="done">Đã hoàn thành</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ưu tiên</label>
                    <select class="form-select" id="edit-task-priority">
                        <option value="low">Thấp</option>
                        <option value="medium">Trung bình</option>
                        <option value="high">Cao</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Hạn hoàn thành</label>
                    <input type="date" class="form-date" id="edit-task-deadline">
                </div>
                <div class="form-group">
                    <label class="form-label">Tags</label>
                    <input type="text" class="form-input" id="edit-task-tags" placeholder="Nhập tags, phân cách bằng dấu phẩy">
                </div>
                <div class="form-group">
                    <label class="form-label">Hình ảnh đính kèm</label>
                    <div class="image-upload" onclick="document.getElementById('edit-task-images').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Nhấp để tải lên hoặc kéo thả hình ảnh</p>
                        <input type="file" id="edit-task-images" multiple style="display: none;" onchange="handleImageUpload(event, 'edit-task')">
                    </div>
                    <div class="uploaded-images" id="edit-task-uploaded-images">
                        <!-- Uploaded images will appear here -->
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ghi chú</label>
                    <textarea class="form-textarea" id="edit-task-notes" placeholder="Thêm ghi chú cho công việc"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('edit-task-modal')">Hủy</button>
                <button class="btn btn-primary" onclick="saveTaskChanges()">Lưu thay đổi</button>
            </div>
        </div>
    </div>

    <!-- Add Note Modal -->
    <div class="modal" id="add-note-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Thêm ghi chú mới</h3>
                <span class="modal-close" onclick="hideModal('add-note-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Tiêu đề ghi chú</label>
                    <input type="text" class="form-input" id="note-title" placeholder="Nhập tiêu đề ghi chú">
                </div>
                <div class="form-group">
                    <label class="form-label">Nội dung ghi chú</label>
                    <textarea class="form-textarea" id="note-content" placeholder="Nhập nội dung ghi chú" rows="6"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Dự án</label>
                    <select class="form-select" id="note-project">
                        <option value="">-- Chọn dự án --</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('add-note-modal')">Hủy</button>
                <button class="btn btn-primary" onclick="addNewNote()">Thêm ghi chú</button>
            </div>
        </div>
    </div>

    <!-- Upload Image Modal -->
    <div class="modal" id="upload-image-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tải lên hình ảnh</h3>
                <span class="modal-close" onclick="hideModal('upload-image-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Dự án</label>
                    <select class="form-select" id="image-project">
                        <option value="">-- Chọn dự án --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Hình ảnh</label>
                    <div class="image-upload" onclick="document.getElementById('global-images').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Nhấp để tải lên hoặc kéo thả hình ảnh</p>
                        <input type="file" id="global-images" multiple style="display: none;" onchange="handleImageUpload(event, 'global')">
                    </div>
                    <div class="uploaded-images" id="global-uploaded-images">
                        <!-- Uploaded images will appear here -->
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Mô tả hình ảnh</label>
                    <textarea class="form-textarea" id="image-description" placeholder="Nhập mô tả cho hình ảnh"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('upload-image-modal')">Hủy</button>
                <button class="btn btn-primary" onclick="uploadImages()">Tải lên</button>
            </div>
        </div>
    </div>

    <script>
        // State management
        const state = {
            projects: JSON.parse(localStorage.getItem('hiderBuildingProjects')) || [],
            notes: JSON.parse(localStorage.getItem('hiderBuildingNotes')) || [],
            images: JSON.parse(localStorage.getItem('hiderBuildingImages')) || [],
            currentProjectId: null,
            currentTask: null,
            uploadedImages: {
                project: [],
                task: [],
                'edit-task': [],
                global: []
            },
            settings: JSON.parse(localStorage.getItem('hiderBuildingSettings')) || {
                language: 'vi',
                timezone: '+7',
                dateFormat: 'dd/mm/yyyy',
                emailNotifications: true,
                taskNotifications: true,
                deadlineNotifications: true,
                notificationFrequency: 'instant',
                theme: 'light',
                density: 'comfortable'
            }
        };

        // DOM Elements
        const projectSelect = document.getElementById('project-select');
        const clockElement = document.getElementById('clock');
        const toastContainer = document.getElementById('toast-container');

        // Initialize the app
        function init() {
            renderProjectOptions();
            updateClock();
            setInterval(updateClock, 1000);
            setupNavigation();
            loadDashboard();
            
            // Load sample data if empty
            if (state.projects.length === 0) {
                loadSampleData();
            }
            
            // Select first project by default
            if (state.projects.length > 0) {
                state.currentProjectId = state.projects[0].id;
                projectSelect.value = state.currentProjectId;
                renderTasks();
            }
        }

        // Setup navigation
        function setupNavigation() {
            const menuItems = document.querySelectorAll('.sidebar-item');
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.dataset.page;
                    navigateTo(page);
                });
            });

            const settingsItems = document.querySelectorAll('.settings-menu-item');
            settingsItems.forEach(item => {
                item.addEventListener('click', () => {
                    const settings = item.dataset.settings;
                    showSettingsSection(settings);
                });
            });
        }

        // Navigate to page
        function navigateTo(page) {
            // Update active menu item
            const menuItems = document.querySelectorAll('.sidebar-item');
            menuItems.forEach(item => {
                if (item.dataset.page === page) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });

            // Show selected page
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(p => {
                if (p.id === `${page}-page`) {
                    p.style.display = 'block';
                } else {
                    p.style.display = 'none';
                }
            });

            // Load page-specific content
            switch(page) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'projects':
                    loadProjectsPage();
                    break;
                case 'images':
                    loadImagesPage();
                    break;
                case 'notes':
                    loadNotesPage();
                    break;
                case 'reports':
                    loadReportsPage();
                    break;
                case 'settings':
                    loadSettingsPage();
                    break;
            }
        }

        // Show settings section
        function showSettingsSection(section) {
            // Update active menu item
            const menuItems = document.querySelectorAll('.settings-menu-item');
            menuItems.forEach(item => {
                if (item.dataset.settings === section) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });

            // Show selected section
            const sections = document.querySelectorAll('.settings-section');
            sections.forEach(s => {
                if (s.id === `${section}-settings`) {
                    s.style.display = 'block';
                } else {
                    s.style.display = 'none';
                }
            });
        }

        // Load dashboard
        function loadDashboard() {
            // Update stats
            document.getElementById('total-projects').textContent = state.projects.length;
            
            let totalTasks = 0;
            let completedTasks = 0;
            
            state.projects.forEach(project => {
                totalTasks += project.tasks.length;
                completedTasks += project.tasks.filter(task => task.status === 'done').length;
            });
            
            document.getElementById('total-tasks').textContent = totalTasks;
            
            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            document.getElementById('overall-progress').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `${progress}% công việc đã hoàn thành`;
            
            // Load recent projects
            const recentProjectsContainer = document.getElementById('recent-projects');
            recentProjectsContainer.innerHTML = '';
            
            if (state.projects.length === 0) {
                recentProjectsContainer.innerHTML = `
                    <li class="project-item">
                        <div class="project-item-info">
                            <div class="project-item-name">Không có dự án nào</div>
                            <div class="project-item-desc">Hãy thêm dự án đầu tiên của bạn</div>
                        </div>
                        <div class="project-item-actions">
                            <button class="btn btn-secondary" disabled>
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </li>
                `;
            } else {
                const recentProjects = state.projects.slice(0, 5);
                recentProjects.forEach(project => {
                    const completed = project.tasks.filter(task => task.status === 'done').length;
                    const total = project.tasks.length;
                    const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
                    
                    const projectItem = document.createElement('li');
                    projectItem.className = 'project-item';
                    projectItem.innerHTML = `
                        <div class="project-item-info">
                            <div class="project-item-name">${project.name}</div>
                            <div class="project-item-desc">${project.description || 'Không có mô tả'}</div>
                            <div class="progress-bar" style="margin: 8px 0; height: 6px;">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="stat-label">${progress}% hoàn thành (${completed}/${total} công việc)</div>
                        </div>
                        <div class="project-item-actions">
                            <button class="btn btn-secondary" onclick="viewProject('${project.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    `;
                    recentProjectsContainer.appendChild(projectItem);
                });
            }
        }

        // Load projects page
        function loadProjectsPage() {
            const projectsContainer = document.getElementById('all-projects');
            projectsContainer.innerHTML = '';
            
            if (state.projects.length === 0) {
                projectsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>Chưa có dự án nào</p>
                        <button class="btn btn-primary" onclick="showAddProjectModal()">
                            <i class="fas fa-plus"></i> Thêm dự án đầu tiên
                        </button>
                    </div>
                `;
            } else {
                state.projects.forEach(project => {
                    const completed = project.tasks.filter(task => task.status === 'done').length;
                    const total = project.tasks.length;
                    const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
                    
                    const projectCard = document.createElement('div');
                    projectCard.className = 'dashboard-card';
                    projectCard.style.marginBottom = '15px';
                    projectCard.innerHTML = `
                        <div class="dashboard-card-header">
                            <h3 class="dashboard-card-title">${project.name}</h3>
                            <div class="project-item-actions">
                                <button class="btn btn-secondary" onclick="viewProject('${project.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-primary" onclick="editProject('${project.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deleteProject('${project.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="project-item-info">
                            <p>${project.description || 'Không có mô tả'}</p>
                            <p><strong>Địa chỉ:</strong> ${project.address || 'Chưa cập nhật'}</p>
                            <div class="progress-bar" style="margin: 10px 0;">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="stat-label">${progress}% hoàn thành (${completed}/${total} công việc)</div>
                            <div class="task-tags" style="margin-top: 10px;">
                                <span class="task-tag">${project.tasks.filter(t => t.status === 'pending').length} Đang chờ</span>
                                <span class="task-tag">${project.tasks.filter(t => t.status === 'doing').length} Đang làm</span>
                                <span class="task-tag">${project.tasks.filter(t => t.status === 'blocked').length} Bị mắc</span>
                                <span class="task-tag">${project.tasks.filter(t => t.status === 'done').length} Hoàn thành</span>
                            </div>
                        </div>
                    `;
                    projectsContainer.appendChild(projectCard);
                });
            }
        }

        // Load images page
        function loadImagesPage() {
            // Populate project select
            const projectSelect = document.getElementById('image-project-select');
            projectSelect.innerHTML = '<option value="">-- Chọn dự án --</option>';
            
            state.projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                projectSelect.appendChild(option);
            });
        }

        // Load project images
        function loadProjectImages(projectId) {
            const imagesContainer = document.getElementById('project-images-container');
            imagesContainer.innerHTML = '';
            
            if (!projectId) {
                imagesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-images"></i>
                        <p>Chưa có hình ảnh nào</p>
                        <p>Hãy chọn một dự án để xem hình ảnh</p>
                    </div>
                `;
                return;
            }
            
            const project = state.projects.find(p => p.id === projectId);
            if (!project) return;
            
            const projectImages = state.images.filter(img => img.projectId === projectId);
            
            if (projectImages.length === 0) {
                imagesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-images"></i>
                        <p>Dự án này chưa có hình ảnh nào</p>
                        <button class="btn btn-primary" onclick="showUploadImageModal()">
                            <i class="fas fa-upload"></i> Tải lên hình ảnh
                        </button>
                    </div>
                `;
                return;
            }
            
            projectImages.forEach(image => {
                const imageCard = document.createElement('div');
                imageCard.className = 'image-card';
                imageCard.innerHTML = `
                    <img src="${image.url}" alt="${image.description || 'Hình ảnh dự án'}">
                    <div class="image-card-body">
                        <div class="image-card-title">${image.description || 'Hình ảnh dự án'}</div>
                        <div class="image-card-date">${formatDate(image.uploadedAt)}</div>
                    </div>
                `;
                imagesContainer.appendChild(imageCard);
            });
        }

        // Load notes page
        function loadNotesPage() {
            // Populate project select
            const projectSelect = document.getElementById('note-project-select');
            projectSelect.innerHTML = '<option value="">-- Chọn dự án --</option>';
            
            state.projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                projectSelect.appendChild(option);
            });
        }

        // Load project notes
        function loadProjectNotes(projectId) {
            const notesContainer = document.getElementById('project-notes-container');
            notesContainer.innerHTML = '';
            
            if (!projectId) {
                notesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-sticky-note"></i>
                        <p>Chưa có ghi chú nào</p>
                        <p>Hãy chọn một dự án để xem ghi chú</p>
                    </div>
                `;
                return;
            }
            
            const projectNotes = state.notes.filter(note => note.projectId === projectId);
            
            if (projectNotes.length === 0) {
                notesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-sticky-note"></i>
                        <p>Dự án này chưa có ghi chú nào</p>
                        <button class="btn btn-primary" onclick="showAddNoteModal()">
                            <i class="fas fa-plus"></i> Thêm ghi chú
                        </button>
                    </div>
                `;
                return;
            }
            
            projectNotes.forEach(note => {
                const noteCard = document.createElement('div');
                noteCard.className = 'note-card';
                noteCard.innerHTML = `
                    <div class="note-card-header">
                        <div class="note-card-title">${note.title}</div>
                        <div class="note-card-date">${formatDate(note.createdAt)}</div>
                    </div>
                    <div class="note-card-content">${note.content}</div>
                    <div class="note-card-footer">
                        <button class="btn btn-secondary" onclick="editNote('${note.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteNote('${note.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                notesContainer.appendChild(noteCard);
            });
        }

        // Load reports page
        function loadReportsPage() {
            // Populate project select
            const projectSelect = document.getElementById('report-project-select');
            projectSelect.innerHTML = '<option value="">-- Tất cả dự án --</option>';
            
            state.projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                projectSelect.appendChild(option);
            });
        }

        // Load project report
        function loadProjectReport(projectId) {
            // This would typically generate charts using a library like Chart.js
            // For simplicity, we'll just show a message
            const statusChart = document.getElementById('task-status-chart');
            const timelineChart = document.getElementById('progress-timeline-chart');
            
            if (!projectId) {
                statusChart.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-pie"></i>
                        <p>Báo cáo tổng hợp tất cả dự án</p>
                    </div>
                `;
                timelineChart.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Báo cáo tổng hợp tất cả dự án</p>
                    </div>
                `;
                return;
            }
            
            const project = state.projects.find(p => p.id === projectId);
            if (!project) return;
            
            statusChart.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-chart-pie"></i>
                    <p>Biểu đồ trạng thái công việc cho: ${project.name}</p>
                </div>
            `;
            
            timelineChart.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-chart-line"></i>
                    <p>Biểu đồ tiến độ theo thời gian cho: ${project.name}</p>
                </div>
            `;
        }

        // Load settings page
        function loadSettingsPage() {
            // Load current settings into form
            document.getElementById('language-select').value = state.settings.language;
            document.getElementById('timezone-select').value = state.settings.timezone;
            document.getElementById('date-format-select').value = state.settings.dateFormat;
            document.getElementById('email-notifications').checked = state.settings.emailNotifications;
            document.getElementById('task-notifications').checked = state.settings.taskNotifications;
            document.getElementById('deadline-notifications').checked = state.settings.deadlineNotifications;
            document.getElementById('notification-frequency').value = state.settings.notificationFrequency;
            document.getElementById('theme-select').value = state.settings.theme;
            document.getElementById('density-select').value = state.settings.density;
        }

        // Show add note modal
        function showAddNoteModal() {
            // Populate project select
            const projectSelect = document.getElementById('note-project');
            projectSelect.innerHTML = '<option value="">-- Chọn dự án --</option>';
            
            state.projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                projectSelect.appendChild(option);
            });
            
            document.getElementById('note-title').value = '';
            document.getElementById('note-content').value = '';
            
            showModal('add-note-modal');
        }

        // Add new note
        function addNewNote() {
            const title = document.getElementById('note-title').value.trim();
            const content = document.getElementById('note-content').value.trim();
            const projectId = document.getElementById('note-project').value;
            
            if (!title) {
                showToast('Vui lòng nhập tiêu đề ghi chú', 'error');
                return;
            }
            
            if (!content) {
                showToast('Vui lòng nhập nội dung ghi chú', 'error');
                return;
            }
            
            if (!projectId) {
                showToast('Vui lòng chọn dự án', 'error');
                return;
            }
            
            const newNote = {
                id: Date.now().toString(),
                title,
                content,
                projectId,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            state.notes.unshift(newNote);
            saveState();
            hideModal('add-note-modal');
            
            showToast('Đã thêm ghi chú mới thành công', 'success');
            
            // Reload notes if we're on the notes page
            if (document.getElementById('notes-page').style.display === 'block') {
                loadProjectNotes(projectId);
            }
        }

        // Show upload image modal
        function showUploadImageModal() {
            // Populate project select
            const projectSelect = document.getElementById('image-project');
            projectSelect.innerHTML = '<option value="">-- Chọn dự án --</option>';
            
            state.projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                projectSelect.appendChild(option);
            });
            
            document.getElementById('image-description').value = '';
            document.getElementById('global-uploaded-images').innerHTML = '';
            state.uploadedImages.global = [];
            
            showModal('upload-image-modal');
        }

        // Upload images
        function uploadImages() {
            const projectId = document.getElementById('image-project').value;
            const description = document.getElementById('image-description').value.trim();
            
            if (!projectId) {
                showToast('Vui lòng chọn dự án', 'error');
                return;
            }
            
            if (state.uploadedImages.global.length === 0) {
                showToast('Vui lòng tải lên ít nhất một hình ảnh', 'error');
                return;
            }
            
            state.uploadedImages.global.forEach(image => {
                const newImage = {
                    id: Date.now().toString(),
                    url: image.src,
                    description,
                    projectId,
                    uploadedAt: new Date().toISOString()
                };
                
                state.images.unshift(newImage);
            });
            
            saveState();
            hideModal('upload-image-modal');
            
            showToast(`Đã tải lên ${state.uploadedImages.global.length} hình ảnh thành công`, 'success');
            
            // Reload images if we're on the images page
            if (document.getElementById('images-page').style.display === 'block') {
                loadProjectImages(projectId);
            }
        }

        // Generate report
        function generateReport() {
            const projectId = document.getElementById('report-project-select').value;
            let reportData;
            
            if (projectId) {
                const project = state.projects.find(p => p.id === projectId);
                if (!project) return;
                
                reportData = {
                    type: 'project',
                    project: project.name,
                    generatedAt: new Date().toISOString(),
                    stats: {
                        totalTasks: project.tasks.length,
                        pending: project.tasks.filter(t => t.status === 'pending').length,
                        doing: project.tasks.filter(t => t.status === 'doing').length,
                        blocked: project.tasks.filter(t => t.status === 'blocked').length,
                        done: project.tasks.filter(t => t.status === 'done').length,
                        completion: project.tasks.length > 0 ? 
                            Math.round((project.tasks.filter(t => t.status === 'done').length / project.tasks.length) * 100) : 0
                    }
                };
            } else {
                let totalTasks = 0;
                let pending = 0;
                let doing = 0;
                let blocked = 0;
                let done = 0;
                
                state.projects.forEach(project => {
                    totalTasks += project.tasks.length;
                    pending += project.tasks.filter(t => t.status === 'pending').length;
                    doing += project.tasks.filter(t => t.status === 'doing').length;
                    blocked += project.tasks.filter(t => t.status === 'blocked').length;
                    done += project.tasks.filter(t => t.status === 'done').length;
                });
                
                reportData = {
                    type: 'all',
                    generatedAt: new Date().toISOString(),
                    stats: {
                        totalProjects: state.projects.length,
                        totalTasks,
                        pending,
                        doing,
                        blocked,
                        done,
                        completion: totalTasks > 0 ? Math.round((done / totalTasks) * 100) : 0
                    }
                };
            }
            
            // Convert to JSON and create download link
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(reportData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `report-${new Date().getTime()}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            showToast('Đã xuất báo cáo thành công', 'success');
        }

        // Backup data
        function backupData() {
            const backupData = {
                projects: state.projects,
                notes: state.notes,
                images: state.images,
                settings: state.settings,
                exportedAt: new Date().toISOString(),
                version: '1.0'
            };
            
            // Convert to JSON and create download link
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(backupData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `hiderbuilding-backup-${new Date().getTime()}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            showToast('Đã sao lưu dữ liệu thành công', 'success');
        }

        // Restore data
        function restoreData() {
            const fileInput = document.getElementById('restore-file');
            if (!fileInput.files.length) {
                showToast('Vui lòng chọn file sao lưu', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Validate backup data
                    if (!backupData.projects || !backupData.notes || !backupData.images || !backupData.settings) {
                        showToast('File sao lưu không hợp lệ', 'error');
                        return;
                    }
                    
                    if (confirm('Bạn có chắc chắn muốn khôi phục dữ liệu? Dữ liệu hiện tại sẽ bị ghi đè.')) {
                        state.projects = backupData.projects;
                        state.notes = backupData.notes;
                        state.images = backupData.images;
                        state.settings = backupData.settings;
                        
                        saveState();
                        init();
                        
                        showToast('Đã khôi phục dữ liệu thành công', 'success');
                    }
                } catch (error) {
                    showToast('Không thể đọc file sao lưu', 'error');
                    console.error(error);
                }
            };
            
            reader.readAsText(file);
        }

        // Confirm reset data
        function confirmResetData() {
            if (confirm('BẠN CÓ CHẮC CHẮN MUỐN XÓA TOÀN BỘ DỮ LIỆU? Hành động này không thể hoàn tác.')) {
                localStorage.removeItem('hiderBuildingProjects');
                localStorage.removeItem('hiderBuildingNotes');
                localStorage.removeItem('hiderBuildingImages');
                localStorage.removeItem('hiderBuildingSettings');
                
                // Reset state
                state.projects = [];
                state.notes = [];
                state.images = [];
                state.settings = {
                    language: 'vi',
                    timezone: '+7',
                    dateFormat: 'dd/mm/yyyy',
                    emailNotifications: true,
                    taskNotifications: true,
                    deadlineNotifications: true,
                    notificationFrequency: 'instant',
                    theme: 'light',
                    density: 'comfortable'
                };
                
                init();
                
                showToast('Đã xóa toàn bộ dữ liệu', 'info');
            }
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            let icon = 'fas fa-info-circle';
            if (type === 'success') icon = 'fas fa-check-circle';
            if (type === 'error') icon = 'fas fa-exclamation-circle';
            if (type === 'warning') icon = 'fas fa-exclamation-triangle';
            
            toast.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
            `;
            
            toastContainer.appendChild(toast);
            
            // Remove toast after animation
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Replace all alert calls with showToast
        // For example: alert('Đã thêm dự án mới thành công!'); becomes:
        // showToast('Đã thêm dự án mới thành công!', 'success');

        // [Rest of the existing functions remain the same, but replace alert calls with showToast]

        // Render project options in select
        function renderProjectOptions() {
            projectSelect.innerHTML = '<option value="">-- Chọn dự án --</option>';
            
            state.projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                projectSelect.appendChild(option);
            });
        }

        // Change current project
        function changeProject(projectId) {
            state.currentProjectId = projectId;
            renderTasks();
        }

        // Get current project
        function getCurrentProject() {
            return state.projects.find(p => p.id === state.currentProjectId);
        }

        // Render tasks for current project
        function renderTasks() {
            const project = getCurrentProject();
            if (!project) {
                // Clear all task lists
                ['pending', 'doing', 'blocked', 'done'].forEach(status => {
                    const taskList = document.getElementById(`${status}-tasks`);
                    taskList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Không có công việc nào</p>
                        </div>
                    `;
                    document.getElementById(`${status}-count`).textContent = '0';
                });
                return;
            }
            
            // Render tasks for each status
            ['pending', 'doing', 'blocked', 'done'].forEach(status => {
                const tasks = project.tasks.filter(t => t.status === status);
                const taskList = document.getElementById(`${status}-tasks`);
                const countElement = document.getElementById(`${status}-count`);
                
                countElement.textContent = tasks.length;
                
                if (tasks.length === 0) {
                    taskList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Không có công việc nào</p>
                        </div>
                    `;
                } else {
                    taskList.innerHTML = '';
                    tasks.forEach(task => {
                        const taskElement = createTaskElement(task);
                        taskList.appendChild(taskElement);
                    });
                }
            });
            
            // Setup drag and drop
            setupDragAndDrop();
        }

        // Create task element
        function createTaskElement(task) {
            const taskEl = document.createElement('div');
            taskEl.className = `task task-${task.status}`;
            taskEl.dataset.taskId = task.id;
            taskEl.draggable = true;
            
            const deadlineText = task.deadline ? formatDate(task.deadline) : 'Không có hạn';
            const priorityText = getPriorityText(task.priority);
            const priorityClass = `priority-${task.priority}`;
            
            let tagsHTML = '';
            if (task.tags && task.tags.length > 0) {
                tagsHTML = `<div class="task-tags">${task.tags.map(tag => `<span class="task-tag">${tag}</span>`).join('')}</div>`;
            }
            
            taskEl.innerHTML = `
                ${tagsHTML}
                <div class="task-title">${task.title}</div>
                ${task.description ? `<div class="task-desc">${task.description}</div>` : ''}
                <div class="task-meta">
                    <div>
                        <div class="task-date">
                            <i class="far fa-calendar-alt"></i>
                            <span>${deadlineText}</span>
                        </div>
                        <div class="priority-badge ${priorityClass}">${priorityText}</div>
                    </div>
                    <div class="task-actions">
                        <i class="fas fa-edit task-action" onclick="event.stopPropagation(); editTask('${task.id}')"></i>
                        <i class="fas fa-trash task-action" onclick="event.stopPropagation(); deleteTask('${task.id}')"></i>
                    </div>
                </div>
            `;
            
            taskEl.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('taskId', task.id);
                e.dataTransfer.setData('fromStatus', task.status);
            });
            
            taskEl.addEventListener('click', () => {
                viewTask(task.id);
            });
            
            return taskEl;
        }

        // Setup drag and drop
        function setupDragAndDrop() {
            const taskLists = document.querySelectorAll('.task-list');
            
            taskLists.forEach(list => {
                list.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    list.style.backgroundColor = 'rgba(0, 0, 0, 0.03)';
                });
                
                list.addEventListener('dragleave', () => {
                    list.style.backgroundColor = '';
                });
                
                list.addEventListener('drop', (e) => {
                    e.preventDefault();
                    list.style.backgroundColor = '';
                    
                    const taskId = e.dataTransfer.getData('taskId');
                    const fromStatus = e.dataTransfer.getData('fromStatus');
                    const toStatus = list.dataset.status;
                    
                    if (fromStatus !== toStatus) {
                        moveTask(taskId, toStatus);
                    }
                });
            });
        }

        // Move task to new status
        function moveTask(taskId, newStatus) {
            const project = getCurrentProject();
            if (!project) return;
            
            const task = project.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            task.status = newStatus;
            task.updatedAt = new Date().toISOString();
            
            saveState();
            renderTasks();
            
            // Check if all tasks are done
            checkProjectCompletion(project);
        }

        // Check if project is completed
        function checkProjectCompletion(project) {
            if (project.tasks.length === 0) return;
            
            const allDone = project.tasks.every(t => t.status === 'done');
            
            if (allDone && !project.completed) {
                project.completed = true;
                project.completedAt = new Date().toISOString();
                showToast(`Chúc mừng! Dự án "${project.name}" đã hoàn thành!`, 'success');
            } else if (!allDone && project.completed) {
                project.completed = false;
                project.completedAt = null;
            }
            
            saveState();
        }

        // Show add task form in column
        function showAddTaskForm(status) {
            document.getElementById(`add-task-form-${status}`).classList.add('active');
        }

        // Hide add task form in column
        function hideAddTaskForm(status) {
            document.getElementById(`add-task-form-${status}`).classList.remove('active');
        }

        // Add task from form in column
        function addTaskFromForm(status) {
            const input = document.querySelector(`#add-task-form-${status} .add-task-input`);
            const title = input.value.trim();
            
            if (!title) return;
            
            const project = getCurrentProject();
            if (!project) {
                showToast('Vui lòng chọn một dự án trước khi thêm công việc', 'error');
                return;
            }
            
            const newTask = {
                id: Date.now().toString(),
                title,
                description: '',
                status,
                priority: 'medium',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            project.tasks.unshift(newTask);
            saveState();
            renderTasks();
            
            // Reset form
            input.value = '';
            hideAddTaskForm(status);
            
            showToast('Đã thêm công việc mới', 'success');
        }

        // Show add project modal
        function showAddProjectModal() {
            document.getElementById('project-name').value = '';
            document.getElementById('project-desc').value = '';
            document.getElementById('project-address').value = '';
            document.getElementById('project-uploaded-images').innerHTML = '';
            state.uploadedImages.project = [];
            
            showModal('add-project-modal');
        }

        // Show add task modal
        function showAddTaskModal() {
            if (!state.currentProjectId) {
                showToast('Vui lòng chọn một dự án trước khi thêm công việc', 'error');
                return;
            }
            
            document.getElementById('task-title').value = '';
            document.getElementById('task-desc').value = '';
            document.getElementById('task-status').value = 'pending';
            document.getElementById('task-priority').value = 'medium';
            document.getElementById('task-deadline').value = '';
            document.getElementById('task-tags').value = '';
            document.getElementById('task-notes').value = '';
            document.getElementById('task-uploaded-images').innerHTML = '';
            state.uploadedImages.task = [];
            
            showModal('add-task-modal');
        }

        // Handle image upload
        function handleImageUpload(event, type) {
            const files = event.target.files;
            const uploadedImagesContainer = document.getElementById(`${type}-uploaded-images`);
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const imageId = Date.now().toString() + i;
                    state.uploadedImages[type].push({
                        id: imageId,
                        src: e.target.result
                    });
                    
                    const imagePreview = document.createElement('div');
                    imagePreview.className = 'image-preview';
                    imagePreview.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <span class="image-remove" onclick="removeImage('${type}', '${imageId}')">&times;</span>
                    `;
                    uploadedImagesContainer.appendChild(imagePreview);
                };
                
                reader.readAsDataURL(file);
            }
        }

        // Remove image
        function removeImage(type, imageId) {
            state.uploadedImages[type] = state.uploadedImages[type].filter(img => img.id !== imageId);
            
            const uploadedImagesContainer = document.getElementById(`${type}-uploaded-images`);
            const imagePreview = uploadedImagesContainer.querySelector(`[data-image-id="${imageId}"]`);
            if (imagePreview) {
                imagePreview.remove();
            }
            
            // Re-render all images
            uploadedImagesContainer.innerHTML = '';
            state.uploadedImages[type].forEach(img => {
                const imagePreview = document.createElement('div');
                imagePreview.className = 'image-preview';
                imagePreview.dataset.imageId = img.id;
                imagePreview.innerHTML = `
                    <img src="${img.src}" alt="Preview">
                    <span class="image-remove" onclick="removeImage('${type}', '${img.id}')">&times;</span>
                `;
                uploadedImagesContainer.appendChild(imagePreview);
            });
        }

        // Add new project
        function addNewProject() {
            const name = document.getElementById('project-name').value.trim();
            const description = document.getElementById('project-desc').value.trim();
            const address = document.getElementById('project-address').value.trim();
            
            if (!name) {
                showToast('Vui lòng nhập tên dự án', 'error');
                return;
            }
            
            const newProject = {
                id: Date.now().toString(),
                name,
                description,
                address,
                images: state.uploadedImages.project.map(img => img.src),
                tasks: [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                completed: false
            };
            
            state.projects.unshift(newProject);
            state.currentProjectId = newProject.id;
            saveState();
            renderProjectOptions();
            renderTasks();
            hideModal('add-project-modal');
            
            showToast('Đã thêm dự án mới thành công!', 'success');
        }

        // Add new task
        function addNewTask() {
            const title = document.getElementById('task-title').value.trim();
            const description = document.getElementById('task-desc').value.trim();
            const status = document.getElementById('task-status').value;
            const priority = document.getElementById('task-priority').value;
            const deadline = document.getElementById('task-deadline').value;
            const tagsInput = document.getElementById('task-tags').value.trim();
            const notes = document.getElementById('task-notes').value.trim();
            
            if (!title) {
                showToast('Vui lòng nhập tiêu đề công việc', 'error');
                return;
            }
            
            const project = getCurrentProject();
            if (!project) return;
            
            // Process tags
            const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
            
            const newTask = {
                id: Date.now().toString(),
                title,
                description,
                status,
                priority,
                deadline,
                tags,
                notes,
                images: state.uploadedImages.task.map(img => img.src),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            project.tasks.unshift(newTask);
            project.updatedAt = new Date().toISOString();
            saveState();
            renderTasks();
            hideModal('add-task-modal');
            
            showToast('Đã thêm công việc mới thành công!', 'success');
        }

        // View task details
        function viewTask(taskId) {
            const project = getCurrentProject();
            if (!project) return;
            
            const task = project.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            state.currentTask = task;
            
            const modalBody = document.querySelector('#task-detail-modal .modal-body');
            const deadlineText = task.deadline ? formatDate(task.deadline) : 'Không có hạn';
            const priorityText = getPriorityText(task.priority);
            const statusText = getStatusText(task.status);
            
            let tagsHTML = '';
            if (task.tags && task.tags.length > 0) {
                tagsHTML = `
                    <div class="form-group">
                        <label class="form-label">Tags</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                            ${task.tags.map(tag => `<span class="task-tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            let imagesHTML = '';
            if (task.images && task.images.length > 0) {
                imagesHTML = `
                    <div class="form-group">
                        <label class="form-label">Hình ảnh đính kèm</label>
                        <div class="uploaded-images">
                            ${task.images.map(img => `
                                <div class="image-preview">
                                    <img src="${img}" alt="Task Image">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            modalBody.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Tiêu đề</label>
                    <div class="form-input" style="background-color: #f8f9fa;">${task.title}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Mô tả</label>
                    <div class="form-textarea" style="background-color: #f8f9fa; min-height: auto;">${task.description || 'Không có mô tả'}</div>
                </div>
                ${tagsHTML}
                <div class="form-group">
                    <label class="form-label">Trạng thái</label>
                    <div class="form-input" style="background-color: #f8f9fa;">${statusText}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ưu tiên</label>
                    <div class="form-input" style="background-color: #f8f9fa;">${priorityText}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Hạn hoàn thành</label>
                    <div class="form-input" style="background-color: #f8f9fa;">${deadlineText}</div>
                </div>
                ${imagesHTML}
                ${task.notes ? `
                <div class="form-group">
                    <label class="form-label">Ghi chú</label>
                    <div class="form-textarea" style="background-color: #f8f9fa; min-height: auto;">${task.notes}</div>
                </div>
                ` : ''}
                <div class="form-group">
                    <label class="form-label">Ngày tạo</label>
                    <div class="form-input" style="background-color: #f8f9fa;">${formatDate(task.createdAt)}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Cập nhật lần cuối</label>
                    <div class="form-input" style="background-color: #f8f9fa;">${formatDate(task.updatedAt)}</div>
                </div>
            `;
            
            document.getElementById('edit-task-btn').onclick = () => editTask(task.id);
            
            showModal('task-detail-modal');
        }

        // Edit task
        function editTask(taskId) {
            const project = getCurrentProject();
            if (!project) return;
            
            const task = project.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            state.currentTask = task;
            state.uploadedImages['edit-task'] = task.images ? task.images.map(img => ({ id: Date.now().toString(), src: img })) : [];
            
            // Fill the edit form with task data
            document.getElementById('edit-task-title').value = task.title;
            document.getElementById('edit-task-desc').value = task.description || '';
            document.getElementById('edit-task-status').value = task.status;
            document.getElementById('edit-task-priority').value = task.priority;
            document.getElementById('edit-task-deadline').value = task.deadline || '';
            document.getElementById('edit-task-tags').value = task.tags ? task.tags.join(', ') : '';
            document.getElementById('edit-task-notes').value = task.notes || '';
            
            // Render existing images
            const uploadedImagesContainer = document.getElementById('edit-task-uploaded-images');
            uploadedImagesContainer.innerHTML = '';
            
            state.uploadedImages['edit-task'].forEach(img => {
                const imagePreview = document.createElement('div');
                imagePreview.className = 'image-preview';
                imagePreview.innerHTML = `
                    <img src="${img.src}" alt="Preview">
                    <span class="image-remove" onclick="removeImage('edit-task', '${img.id}')">&times;</span>
                `;
                uploadedImagesContainer.appendChild(imagePreview);
            });
            
            hideModal('task-detail-modal');
            showModal('edit-task-modal');
        }

        // Save task changes
        function saveTaskChanges() {
            if (!state.currentTask) return;
            
            const project = getCurrentProject();
            if (!project) return;
            
            const task = project.tasks.find(t => t.id === state.currentTask.id);
            if (!task) return;
            
            // Get values from form
            const title = document.getElementById('edit-task-title').value.trim();
            const description = document.getElementById('edit-task-desc').value.trim();
            const status = document.getElementById('edit-task-status').value;
            const priority = document.getElementById('edit-task-priority').value;
            const deadline = document.getElementById('edit-task-deadline').value;
            const tagsInput = document.getElementById('edit-task-tags').value.trim();
            const notes = document.getElementById('edit-task-notes').value.trim();
            
            if (!title) {
                showToast('Vui lòng nhập tiêu đề công việc', 'error');
                return;
            }
            
            // Process tags
            const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
            
            // Update task properties
            task.title = title;
            task.description = description;
            task.status = status;
            task.priority = priority;
            task.deadline = deadline;
            task.tags = tags;
            task.notes = notes;
            task.images = state.uploadedImages['edit-task'].map(img => img.src);
            task.updatedAt = new Date().toISOString();
            
            project.updatedAt = new Date().toISOString();
            saveState();
            renderTasks();
            hideModal('edit-task-modal');
            
            showToast('Đã cập nhật công việc thành công!', 'success');
        }

        // Delete current task
        function deleteCurrentTask() {
            if (!state.currentTask) return;
            
            deleteTask(state.currentTask.id);
            hideModal('task-detail-modal');
        }

        // Delete task
        function deleteTask(taskId) {
            if (!confirm('Bạn có chắc chắn muốn xóa công việc này?')) return;
            
            const project = getCurrentProject();
            if (!project) return;
            
            project.tasks = project.tasks.filter(t => t.id !== taskId);
            project.updatedAt = new Date().toISOString();
            saveState();
            renderTasks();
            
            showToast('Đã xóa công việc thành công!', 'success');
        }

        // View project
        function viewProject(projectId) {
            // For simplicity, just switch to the tasks page and select the project
            navigateTo('tasks');
            state.currentProjectId = projectId;
            document.getElementById('project-select').value = projectId;
            renderTasks();
        }

        // Edit project
        function editProject(projectId) {
            // Implementation for editing a project
            showToast('Tính năng chỉnh sửa dự án sẽ được triển khai trong phiên bản tới', 'info');
        }

        // Delete project
        function deleteProject(projectId) {
            if (!confirm('Bạn có chắc chắn muốn xóa dự án này? Tất cả công việc và dữ liệu liên quan sẽ bị xóa.')) return;
            
            state.projects = state.projects.filter(p => p.id !== projectId);
            
            // Also remove related notes and images
            state.notes = state.notes.filter(n => n.projectId !== projectId);
            state.images = state.images.filter(i => i.projectId !== projectId);
            
            saveState();
            
            // If we were viewing this project, clear the view
            if (state.currentProjectId === projectId) {
                state.currentProjectId = state.projects.length > 0 ? state.projects[0].id : null;
                if (state.currentProjectId) {
                    document.getElementById('project-select').value = state.currentProjectId;
                    renderTasks();
                } else {
                    renderTasks(); // This will clear the tasks view
                }
            }
            
            // Reload the current page
            if (document.getElementById('projects-page').style.display === 'block') {
                loadProjectsPage();
            } else if (document.getElementById('dashboard-page').style.display === 'block') {
                loadDashboard();
            }
            
            showToast('Đã xóa dự án thành công', 'success');
        }

        // Edit note
        function editNote(noteId) {
            // Implementation for editing a note
            showToast('Tính năng chỉnh sửa ghi chú sẽ được triển khai trong phiên bản tới', 'info');
        }

        // Delete note
        function deleteNote(noteId) {
            if (!confirm('Bạn có chắc chắn muốn xóa ghi chú này?')) return;
            
            state.notes = state.notes.filter(n => n.id !== noteId);
            saveState();
            
            // Reload notes if we're on the notes page
            if (document.getElementById('notes-page').style.display === 'block') {
                const projectId = document.getElementById('note-project-select').value;
                loadProjectNotes(projectId);
            }
            
            showToast('Đã xóa ghi chú thành công', 'success');
        }

        // Get status text
        function getStatusText(status) {
            const statusMap = {
                'pending': 'Đang chờ',
                'doing': 'Đang làm',
                'blocked': 'Bị mắc',
                'done': 'Đã hoàn thành'
            };
            return statusMap[status] || status;
        }

        // Get priority text
        function getPriorityText(priority) {
            const priorityMap = {
                'low': 'Thấp',
                'medium': 'Trung bình',
                'high': 'Cao'
            };
            return priorityMap[priority] || priority;
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // Update clock
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            clockElement.textContent = `${hours}:${minutes}:${seconds}`;
        }

        // Show modal
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        // Hide modal
        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('hiderBuildingProjects', JSON.stringify(state.projects));
            localStorage.setItem('hiderBuildingNotes', JSON.stringify(state.notes));
            localStorage.setItem('hiderBuildingImages', JSON.stringify(state.images));
            localStorage.setItem('hiderBuildingSettings', JSON.stringify(state.settings));
        }

        // Load sample data
        function loadSampleData() {
            state.projects = [
                {
                    id: '1',
                    name: 'Dự án Sunshine City',
                    description: 'Khu đô thị hiện đại với đầy đủ tiện ích',
                    address: '123 Nguyễn Văn Linh, Quận 7, TP.HCM',
                    images: [],
                    tasks: [
                        {
                            id: '101',
                            title: 'Khảo sát địa chất',
                            description: 'Tiến hành khảo sát địa chất khu vực xây dựng',
                            status: 'done',
                            priority: 'high',
                            deadline: '2023-06-15',
                            tags: ['khảo sát', 'địa chất'],
                            notes: 'Đã hoàn thành đúng hạn',
                            images: [],
                            createdAt: '2023-05-10T08:00:00',
                            updatedAt: '2023-06-15T17:30:00'
                        },
                        {
                            id: '102',
                            title: 'Xin giấy phép xây dựng',
                            description: 'Chuẩn bị hồ sơ và xin giấy phép xây dựng',
                            status: 'doing',
                            priority: 'high',
                            deadline: '2023-07-20',
                            tags: ['pháp lý', 'giấy phép'],
                            notes: 'Đang chờ phê duyệt từ Sở Xây dựng',
                            images: [],
                            createdAt: '2023-06-01T08:00:00',
                            updatedAt: '2023-06-25T10:15:00'
                        },
                        {
                            id: '103',
                            title: 'Thiết kế chi tiết căn hộ mẫu',
                            description: 'Thiết kế nội thất cho căn hộ mẫu',
                            status: 'pending',
                            priority: 'medium',
                            deadline: '2023-08-01',
                            tags: ['thiết kế', 'nội thất'],
                            notes: '',
                            images: [],
                            createdAt: '2023-06-20T08:00:00',
                            updatedAt: '2023-06-20T08:00:00'
                        }
                    ],
                    createdAt: '2023-05-01T08:00:00',
                    updatedAt: '2023-06-25T10:15:00',
                    completed: false
                },
                {
                    id: '2',
                    name: 'Dự án Biệt thự Biển Đông',
                    description: 'Khu biệt thự nghỉ dưỡng cao cấp view biển',
                    address: '789 Võ Nguyên Giáp, Đà Nẵng',
                    images: [],
                    tasks: [
                        {
                            id: '201',
                            title: 'Lựa chọn nhà thầu',
                            description: 'Đấu thầu và lựa chọn nhà thầu xây dựng',
                            status: 'blocked',
                            priority: 'high',
                            deadline: '2023-06-30',
                            tags: ['đấu thầu', 'nhà thầu'],
                            notes: 'Chờ phê duyệt ngân sách',
                            images: [],
                            createdAt: '2023-05-15T08:00:00',
                            updatedAt: '2023-06-20T14:20:00'
                        },
                        {
                            id: '202',
                            title: 'Thiết kế cảnh quan',
                            description: 'Thiết kế cảnh quan tổng thể khu biệt thự',
                            status: 'pending',
                            priority: 'medium',
                            deadline: '2023-07-15',
                            tags: ['thiết kế', 'cảnh quan'],
                            notes: '',
                            images: [],
                            createdAt: '2023-06-10T08:00:00',
                            updatedAt: '2023-06-10T08:00:00'
                        }
                    ],
                    createdAt: '2023-05-10T08:00:00',
                    updatedAt: '2023-06-20T14:20:00',
                    completed: false
                }
            ];
            
            state.notes = [
                {
                    id: '1',
                    title: 'Ghi chú về vật liệu xây dựng',
                    content: 'Cần lựa chọn vật liệu thân thiện với môi trường và có chứng chỉ xanh. Ưu tiên vật liệu địa phương để giảm chi phí vận chuyển.',
                    projectId: '1',
                    createdAt: '2023-05-15T10:30:00',
                    updatedAt: '2023-05-15T10:30:00'
                },
                {
                    id: '2',
                    title: 'Ý tưởng thiết kế cảnh quan',
                    content: 'Nên kết hợp hồ nước và cây xanh để tạo không gian mát mẻ. Cân nhắc sử dụng đèn LED tiết kiệm năng lượng cho chiếu sáng ban đêm.',
                    projectId: '2',
                    createdAt: '2023-06-01T14:45:00',
                    updatedAt: '2023-06-01T14:45:00'
                }
            ];
            
            saveState();
        }

        // Initialize the app
        init();
    </script>
</body>

</html>